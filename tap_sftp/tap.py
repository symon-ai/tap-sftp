import json
import sys
import singer  # type: ignore
import traceback
from singer import utils
from terminaltables import AsciiTable  # type: ignore
from file_processors.utils.stat_collector import FILE_SYNC_STATS  # type: ignore
from file_processors.utils.np_encoder import NpEncoder  # type: ignore
from file_processors.utils.symon_exception import SymonException  # type: ignore
from tap_sftp import discover
from tap_sftp import sync

REQUIRED_CONFIG_KEYS = ["username", "port", "host", "tables", "start_date"]
REQUIRED_DECRYPT_CONFIG_KEYS = ['key_name']
REQUIRED_COMMON_TABLE_SPEC_CONFIG_KEYS = [
    "file_type", "search_prefix", "search_pattern"]
REQUIRED_CSV_TABLE_SPEC_CONFIG_KEYS = ["table_name"]

LOGGER = singer.get_logger()


def do_discover(config):
    LOGGER.info("Starting discover")
    streams = discover.discover_streams(config)
    if not streams:
        raise SymonException('File is empty.', 'EmptyFile')
    catalog = {"streams": streams}
    json.dump(catalog, sys.stdout, indent=2, cls=NpEncoder)
    LOGGER.info("Finished discover")


def stream_is_selected(mdata):
    return mdata.get((), {}).get('selected', False)


def do_sync(config, catalog, state):
    collect_sync_stats = config.get("show_stats", False)
    err_msg = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Nunc aliquet bibendum enim facilisis gravida neque convallis a cras. Velit euismod in pellentesque massa placerat duis ultricies lacus sed. Nunc non blandit massa enim nec dui. Ullamcorper eget nulla facilisi etiam dignissim diam quis. Pellentesque eu tincidunt tortor aliquam nulla facilisi cras fermentum odio. Pulvinar elementum integer enim neque volutpat ac tincidunt vitae. Blandit turpis cursus in hac habitasse platea dictumst quisque sagittis. Eget mauris pharetra et ultrices neque. Iaculis at erat pellentesque adipiscing commodo. Senectus et netus et malesuada fames. Malesuada fames ac turpis egestas integer eget. Nunc consequat interdum varius sit. Ultrices neque ornare aenean euismod. Aliquet risus feugiat in ante metus dictum at tempor commodo. Adipiscing vitae proin sagittis nisl rhoncus. Mauris in aliquam sem fringilla ut. Ut sem nulla pharetra diam sit amet. Justo eget magna fermentum iaculis eu non diam phasellus. Suspendisse ultrices gravida dictum fusce ut placerat. Et netus et malesuada fames. Dignissim convallis aenean et tortor at risus viverra adipiscing at. Tincidunt tortor aliquam nulla facilisi cras. Nulla facilisi morbi tempus iaculis urna id volutpat lacus laoreet. Ultrices dui sapien eget mi proin. Leo a diam sollicitudin tempor id eu nisl nunc mi. Est ultricies integer quis auctor elit sed vulputate mi. Eget sit amet tellus cras adipiscing. Sed viverra ipsum nunc aliquet bibendum enim facilisis gravida neque. Nec ullamcorper sit amet risus nullam. Ornare arcu dui vivamus arcu felis bibendum ut tristique et. Elit at imperdiet dui accumsan sit amet nulla. Amet nulla facilisi morbi tempus iaculis urna id volutpat lacus. Diam phasellus vestibulum lorem sed risus ultricies tristique nulla. Accumsan in nisl nisi scelerisque eu ultrices vitae auctor eu. Mauris in aliquam sem fringilla ut morbi tincidunt augue. Consequat semper viverra nam libero justo laoreet sit amet cursus. In mollis nunc sed id semper risus. Faucibus nisl tincidunt eget nullam non. Nisl pretium fusce id velit ut. Penatibus et magnis dis parturient montes. Massa tempor nec feugiat nisl. Dolor magna eget est lorem ipsum dolor. Lectus quam id leo in vitae turpis massa. Volutpat commodo sed egestas egestas fringilla phasellus faucibus. Amet luctus venenatis lectus magna fringilla urna porttitor rhoncus. Ultrices eros in cursus turpis massa tincidunt dui ut ornare. Consequat interdum varius sit amet mattis vulputate enim nulla aliquet. Elementum integer enim neque volutpat ac tincidunt. Lectus magna fringilla urna porttitor rhoncus. Urna id volutpat lacus laoreet. Nisi lacus sed viverra tellus in hac. Feugiat in ante metus dictum at tempor commodo ullamcorper. Viverra maecenas accumsan lacus vel facilisis volutpat est velit egestas. Purus in mollis nunc sed id semper risus in hendrerit. Non nisi est sit amet facilisis. Facilisis magna etiam tempor orci. Convallis tellus id interdum velit laoreet id donec ultrices. Facilisi etiam dignissim diam quis enim. In nulla posuere sollicitudin aliquam ultrices sagittis orci a scelerisque. Sed ullamcorper morbi tincidunt ornare massa eget egestas purus viverra. Vel elit scelerisque mauris pellentesque pulvinar pellentesque. Ornare arcu dui vivamus arcu felis bibendum ut tristique. Donec et odio pellentesque diam volutpat commodo. Nunc id cursus metus aliquam eleifend mi in. Ante metus dictum at tempor. Massa tincidunt nunc pulvinar sapien et ligula ullamcorper malesuada proin. At varius vel pharetra vel turpis nunc eget. Auctor neque vitae tempus quam pellentesque. Nulla facilisi nullam vehicula ipsum a arcu cursus vitae. Imperdiet proin fermentum leo vel orci porta non. Est sit amet facilisis magna etiam tempor orci eu lobortis. Elementum tempus egestas sed sed risus pretium quam vulputate dignissim. Velit ut tortor pretium viverra suspendisse potenti. Eleifend mi in nulla posuere sollicitudin aliquam ultrices sagittis. Sapien eget mi proin sed libero enim sed faucibus. Sed arcu non odio euismod lacinia at quis. Pellentesque elit ullamcorper dignissim cras tincidunt lobortis feugiat vivamus. Fusce ut placerat orci nulla pellentesque dignissim enim sit amet. Dolor sed viverra ipsum nunc aliquet bibendum enim. Amet consectetur adipiscing elit duis tristique. Diam volutpat commodo sed egestas egestas fringilla phasellus faucibus scelerisque. Risus commodo viverra maecenas accumsan lacus vel facilisis volutpat. Adipiscing elit ut aliquam purus sit amet luctus. Viverra nibh cras pulvinar mattis nunc. Libero nunc consequat interdum varius sit. Nulla malesuada pellentesque elit eget gravida. Amet consectetur adipiscing elit duis tristique sollicitudin nibh. Justo nec ultrices dui sapien eget mi proin. Euismod quis viverra nibh cras pulvinar. Aliquet sagittis id consectetur purus ut. Sit amet risus nullam eget felis eget nunc lobortis mattis. Sed risus ultricies tristique nulla aliquet enim tortor at. Vel elit scelerisque mauris pellentesque pulvinar pellentesque habitant. Purus viverra accumsan in nisl nisi. Est lorem ipsum dolor sit amet consectetur. Consectetur lorem donec massa sapien faucibus et. Pretium vulputate sapien nec sagittis. Ullamcorper dignissim cras tincidunt lobortis feugiat vivamus at augue. Scelerisque in dictum non consectetur a erat nam at. Quis varius quam quisque id diam vel. Ullamcorper malesuada proin libero nunc consequat interdum varius sit amet. Neque volutpat ac tincidunt vitae semper. Gravida arcu ac tortor dignissim convallis aenean et. Mi sit amet mauris commodo quis imperdiet massa tincidunt nunc. Mattis vulputate enim nulla aliquet porttitor lacus luctus accumsan. Turpis egestas sed tempus urna. Sem fringilla ut morbi tincidunt augue interdum. Nec ultrices dui sapien eget mi proin sed libero. Massa vitae tortor condimentum lacinia quis vel eros donec. Nisl condimentum id venenatis a condimentum. Varius duis at consectetur lorem. Elit ut aliquam purus sit amet luctus venenatis lectus magna. Lorem dolor sed viverra ipsum nunc aliquet bibendum. Lectus sit amet est placerat in egestas erat imperdiet. Lacus laoreet non curabitur gravida. Non quam lacus suspendisse faucibus interdum posuere lorem ipsum. Quis vel eros donec ac. Tincidunt tortor aliquam nulla facilisi cras fermentum odio. Elementum eu facilisis sed odio morbi quis commodo odio. In vitae turpis massa sed elementum tempus egestas sed sed. Id nibh tortor id aliquet lectus proin nibh nisl condimentum. Dictum at tempor commodo ullamcorper a lacus. Nunc scelerisque viverra mauris in aliquam sem fringilla. Parturient montes nascetur ridiculus mus mauris vitae ultricies. Egestas integer eget aliquet nibh praesent tristique magna sit amet. Amet mauris commodo quis imperdiet. In arcu cursus euismod quis viverra nibh. Erat imperdiet sed euismod nisi porta lorem. Eleifend donec pretium vulputate sapien nec sagittis aliquam malesuada. Sit amet tellus cras adipiscing enim eu. Nisi lacus sed viverra tellus in. Enim lobortis scelerisque fermentum dui faucibus in ornare. Suspendisse ultrices gravida dictum fusce ut placerat orci nulla. Aliquet porttitor lacus luctus accumsan tortor posuere ac ut consequat. Amet nisl purus in mollis. Fringilla urna porttitor rhoncus dolor purus non. Velit sed ullamcorper morbi tincidunt ornare massa eget. Feugiat in fermentum posuere urna nec tincidunt praesent semper. Nibh ipsum consequat nisl vel pretium lectus. Mauris rhoncus aenean vel elit scelerisque mauris pellentesque. Lorem ipsum dolor sit amet consectetur adipiscing. Et leo duis ut diam quam nulla. Tellus cras adipiscing enim eu turpis. Nisl condimentum id venenatis a condimentum vitae sapien pellentesque. Sed ullamcorper morbi tincidunt ornare massa. Porttitor lacus luctus accumsan tortor posuere ac ut. Aliquam purus sit amet luctus venenatis lectus magna. Sem viverra aliquet eget sit amet tellus. Orci sagittis eu volutpat odio facilisis mauris sit. Augue mauris augue neque gravida in fermentum. Mauris pellentesque pulvinar pellentesque habitant. Varius vel pharetra vel turpis nunc eget lorem dolor sed. Ullamcorper a lacus vestibulum sed arcu non odio. Condimentum mattis pellentesque id nibh tortor id. Accumsan in nisl nisi scelerisque. A condimentum vitae sapien pellentesque habitant. Felis imperdiet proin fermentum leo vel orci porta. Vitae tortor condimentum lacinia quis. Arcu dui vivamus arcu felis bibendum ut. Purus gravida quis blandit turpis cursus in hac habitasse platea. Mauris ultrices eros in cursus turpis massa tincidunt. Molestie ac feugiat sed lectus vestibulum. Etiam sit amet nisl purus in. Vitae et leo duis ut diam quam. Aliquet nibh praesent tristique magna sit amet purus gravida quis. Enim ut sem viverra aliquet eget sit amet. Elit duis tristique sollicitudin nibh sit amet commodo nulla. Pharetra sit amet aliquam id diam maecenas ultricies. Eget velit aliquet sagittis id. Aenean et tortor at risus. Egestas quis ipsum suspendisse ultrices gravida dictum fusce ut. Massa sed elementum tempus egestas sed sed risus. Sit amet venenatis urna cursus eget nunc scelerisque viverra. Neque egestas congue quisque egestas diam in arcu. Elementum nisi quis eleifend quam adipiscing vitae proin. Praesent semper feugiat nibh sed pulvinar proin. Hendrerit dolor magna eget est lorem. Massa eget egestas purus viverra accumsan in nisl nisi. Pharetra massa massa ultricies mi quis hendrerit dolor. Euismod nisi porta lorem mollis aliquam ut porttitor. Ac ut consequat semper viverra nam libero. Ornare aenean euismod elementum nisi quis. Egestas maecenas pharetra convallis posuere morbi leo. Maecenas sed enim ut sem viverra. Tellus at urna condimentum mattis. Fermentum leo vel orci porta non pulvinar neque. Mauris vitae ultricies leo integer malesuada nunc vel risus. Mattis ullamcorper velit sed ullamcorper. Nibh ipsum consequat nisl vel pretium. Vitae congue mauris rhoncus aenean vel. Quis viverra nibh cras pulvinar mattis nunc sed. In massa tempor nec feugiat nisl pretium fusce id velit. Bibendum enim facilisis gravida neque. Morbi tristique senectus et netus et malesuada. Id porta nibh venenatis cras sed felis eget velit aliquet. Nibh nisl condimentum id venenatis. Ipsum suspendisse ultrices gravida dictum fusce ut. Dis parturient montes nascetur ridiculus mus mauris. Nibh venenatis cras sed felis eget velit aliquet sagittis id. Tempus urna et pharetra pharetra massa. Tempor commodo ullamcorper a lacus vestibulum sed arcu non odio. Massa sed elementum tempus egestas sed sed risus. Viverra aliquet eget sit amet tellus cras. Sed risus pretium quam vulputate dignissim suspendisse in est. In hac habitasse platea dictumst quisque sagittis purus sit. Non arcu risus quis varius quam quisque. Quisque id diam vel quam elementum. Tellus in hac habitasse platea dictumst vestibulum rhoncus. Id diam vel quam elementum pulvinar etiam non quam lacus. Turpis egestas maecenas pharetra convallis posuere morbi leo. Diam sollicitudin tempor id eu nisl. Risus quis varius quam quisque id diam vel quam elementum. Purus in massa tempor nec. Eget nunc lobortis mattis aliquam. In fermentum et sollicitudin ac orci. Mauris cursus mattis molestie a iaculis. Dui accumsan sit amet nulla facilisi morbi tempus. Egestas integer eget aliquet nibh praesent tristique magna sit amet. Quam adipiscing vitae proin sagittis nisl rhoncus. Amet mattis vulputate enim nulla aliquet porttitor lacus. Tincidunt dui ut ornare lectus sit amet est placerat in. Auctor elit sed vulputate mi sit amet mauris commodo. Curabitur vitae nunc sed velit dignissim sodales. Enim nec dui nunc mattis enim ut tellus elementum. Nunc scelerisque viverra mauris in aliquam. Massa vitae tortor condimentum lacinia quis vel eros. Elementum sagittis vitae et leo duis ut diam quam. Id diam maecenas ultricies mi. Pellentesque eu tincidunt tortor aliquam nulla facilisi. Magna fermentum iaculis eu non diam phasellus vestibulum lorem sed. Feugiat sed lectus vestibulum mattis ullamcorper velit sed. Enim ut sem viverra aliquet eget sit amet tellus cras. Lacus sed turpis tincidunt id aliquet risus feugiat in. Arcu odio ut sem nulla pharetra diam sit amet. Quam adipiscing vitae proin sagittis. Urna neque viverra justo nec ultrices dui. Ac orci phasellus egestas tellus rutrum tellus pellentesque eu. Amet nisl purus in mollis nunc sed id semper risus. Elementum eu facilisis sed odio morbi. Auctor urna nunc id cursus. Mauris ultrices eros in cursus turpis massa tincidunt. Diam donec adipiscing tristique risus nec. Maecenas ultricies mi eget mauris pharetra et ultrices neque. Bibendum enim facilisis gravida neque convallis a cras semper auctor. Molestie ac feugiat sed lectus. Ut faucibus pulvinar elementum integer enim neque volutpat ac tincidunt. Ultricies tristique nulla aliquet enim tortor at auctor urna. Elementum nisi quis eleifend quam. Odio aenean sed adipiscing diam donec. Lobortis mattis aliquam faucibus purus in massa tempor nec feugiat. Interdum posuere lorem ipsum dolor sit amet consectetur. Ultricies leo integer malesuada nunc. Lorem dolor sed viverra ipsum nunc aliquet bibendum. Cursus turpis massa tincidunt dui ut ornare lectus sit. Ut tortor pretium viverra suspendisse potenti nullam. Dictum sit amet justo donec enim diam. At augue eget arcu dictum varius. Egestas quis ipsum suspendisse ultrices gravida dictum fusce ut placerat. Et netus et malesuada fames ac. At lectus urna duis convallis convallis tellus id interdum velit. Lacus sed viverra tellus in hac habitasse platea dictumst vestibulum. Quis lectus nulla at volutpat diam ut venenatis tellus. Sed enim ut sem viverra aliquet eget sit amet. Purus gravida quis blandit turpis cursus. Quisque non tellus orci ac auctor augue mauris. Eget felis eget nunc lobortis mattis aliquam. Sed adipiscing diam donec adipiscing tristique risus nec feugiat in. Pretium vulputate sapien nec sagittis aliquam malesuada bibendum arcu vitae. Mi quis hendrerit dolor magna. In fermentum posuere urna nec tincidunt praesent semper. A pellentesque sit amet porttitor eget dolor morbi non. Porttitor leo a diam sollicitudin tempor id eu. In pellentesque massa placerat duis ultricies lacus sed. Elit duis tristique sollicitudin nibh sit. Non pulvinar neque laoreet suspendisse interdum. Et malesuada fames ac turpis egestas sed tempus urna. Velit ut tortor pretium viverra suspendisse. Nulla posuere sollicitudin aliquam ultrices. Venenatis urna cursus eget nunc scelerisque viverra mauris in. Commodo odio aenean sed adipiscing diam. Accumsan lacus vel facilisis volutpat est. Est pellentesque elit ullamcorper dignissim cras tincidunt lobortis feugiat. Adipiscing elit duis tristique sollicitudin nibh sit amet. Sed libero enim sed faucibus turpis in eu mi. Aenean vel elit scelerisque mauris pellentesque pulvinar pellentesque habitant. Tincidunt nunc pulvinar sapien et ligula. Tincidunt vitae semper quis lectus nulla at volutpat diam. Commodo viverra maecenas accumsan lacus vel facilisis volutpat est. Pretium quam vulputate dignissim suspendisse in est. Dignissim enim sit amet venenatis urna cursus eget nunc scelerisque. Nunc sed blandit libero volutpat sed. Tempor id eu nisl nunc mi ipsum faucibus. Id volutpat lacus laoreet non curabitur gravida arcu ac. Pretium lectus quam id leo. Euismod quis viverra nibh cras pulvinar. Faucibus interdum posuere lorem ipsum dolor sit amet. Malesuada proin libero nunc consequat interdum varius. Congue nisi vitae suscipit tellus mauris a diam maecenas sed. Dignissim enim sit amet venenatis urna cursus eget nunc. Aliquet nec ullamcorper sit amet. Libero justo laoreet sit amet cursus. Elementum nibh tellus molestie nunc non blandit massa. Accumsan tortor posuere ac ut consequat semper viverra. Aliquam malesuada bibendum arcu vitae elementum curabitur. Massa eget egestas purus viverra accumsan in. Elit pellentesque habitant morbi tristique senectus et netus et. Nec feugiat nisl pretium fusce id velit ut tortor pretium. Ac tortor dignissim convallis aenean. Eget lorem dolor sed viverra ipsum nunc aliquet. Ac ut consequat semper viverra nam libero justo. Ullamcorper dignissim cras tincidunt lobortis feugiat vivamus at augue. Ipsum a arcu cursus vitae congue mauris rhoncus aenean. Semper quis lectus nulla at volutpat diam ut. Aenean euismod elementum nisi quis eleifend. Sed risus pretium quam vulputate dignissim suspendisse in est ante. Odio ut enim blandit volutpat. Posuere sollicitudin aliquam ultrices sagittis orci a scelerisque. Ullamcorper eget nulla facilisi etiam. Vitae congue eu consequat ac felis donec et. Placerat orci nulla pellentesque dignissim enim sit amet venenatis urna. At quis risus sed vulputate odio ut enim blandit volutpat. Id aliquet lectus proin nibh nisl. Mi eget mauris pharetra et. Iaculis eu non diam phasellus vestibulum lorem sed risus ultricies. Posuere sollicitudin aliquam ultrices sagittis orci a scelerisque. Tellus rutrum tellus pellentesque eu tincidunt tortor aliquam nulla facilisi. Habitant morbi tristique senectus et. Malesuada bibendum arcu vitae elementum. A diam sollicitudin tempor id. Diam maecenas ultricies mi eget mauris pharetra. Magna etiam tempor orci eu lobortis. Duis tristique sollicitudin nibh sit amet. Id neque aliquam vestibulum morbi blandit. Cursus in hac habitasse platea dictumst quisque sagittis purus. Lorem dolor sed viverra ipsum nunc. Amet justo donec enim diam vulputate ut pharetra sit amet. Sollicitudin ac orci phasellus egestas. Ac tortor vitae purus faucibus. Arcu ac tortor dignissim convallis aenean et tortor. Mattis pellentesque id nibh tortor id. Risus ultricies tristique nulla aliquet enim. Placerat in egestas erat imperdiet sed euismod nisi porta. Amet consectetur adipiscing elit pellentesque habitant morbi tristique senectus et. A condimentum vitae sapien pellentesque habitant morbi tristique senectus. Porta nibh venenatis cras sed felis. Adipiscing bibendum est ultricies integer quis auctor elit sed. Aliquet porttitor lacus luctus accumsan tortor posuere ac ut. Mattis molestie a iaculis at erat pellentesque adipiscing. Ac turpis egestas integer eget aliquet nibh. Vitae semper quis lectus nulla at volutpat. Dis parturient montes nascetur ridiculus mus mauris. Volutpat consequat mauris nunc congue nisi vitae suscipit tellus. Odio tempor orci dapibus ultrices. Mattis ullamcorper velit sed ullamcorper morbi tincidunt. Tempor orci dapibus ultrices in iaculis. Ullamcorper dignissim cras tincidunt lobortis feugiat vivamus at augue eget. Mauris ultrices eros in cursus turpis massa. Adipiscing enim eu turpis egestas pretium aenean pharetra. Viverra accumsan in nisl nisi. Fusce id velit ut tortor pretium viverra suspendisse potenti nullam. Ut morbi tincidunt augue interdum velit euismod. Bibendum est ultricies integer quis. Ipsum a arcu cursus vitae. Leo a diam sollicitudin tempor id. Ac placerat vestibulum lectus mauris. Bibendum neque egestas congue quisque. In fermentum et sollicitudin ac. Ultricies mi quis hendrerit dolor magna. Tempor commodo ullamcorper a lacus vestibulum sed arcu non odio. At tempor commodo ullamcorper a lacus vestibulum sed arcu non. Quis imperdiet massa tincidunt nunc pulvinar sapien et. Eu scelerisque felis imperdiet proin fermentum. Aliquam purus sit amet luctus. A diam sollicitudin tempor id eu nisl nunc mi. Egestas sed tempus urna et. Urna nec tincidunt praesent semper feugiat. Turpis tincidunt id aliquet risus feugiat in ante. Ornare arcu odio ut sem nulla pharetra. Orci dapibus ultrices in iaculis nunc sed augue. Enim facilisis gravida neque convallis a cras semper auctor. Amet commodo nulla facilisi nullam vehicula ipsum a arcu cursus. Tincidunt nunc pulvinar sapien et ligula ullamcorper malesuada proin. Rutrum quisque non tellus orci ac auctor augue. Ullamcorper sit amet risus nullam eget felis eget. Et tortor at risus viverra adipiscing at. Risus at ultrices mi tempus imperdiet nulla malesuada pellentesque. Morbi tempus iaculis urna id volutpat lacus. Commodo viverra maecenas accumsan lacus. Dui faucibus in ornare quam viverra. Purus viverra accumsan in nisl nisi scelerisque eu ultrices vitae. Ut consequat semper viverra nam libero justo laoreet. Non arcu risus quis varius quam quisque id. Pellentesque id nibh tortor id aliquet. Malesuada fames ac turpis egestas integer eget aliquet nibh praesent. Cras semper auctor neque vitae tempus quam pellentesque nec. Posuere sollicitudin aliquam ultrices sagittis. Eu turpis egestas pretium aenean pharetra magna. Enim lobortis scelerisque fermentum dui faucibus. Ultricies tristique nulla aliquet enim tortor. Turpis nunc eget lorem dolor sed viverra ipsum nunc aliquet. Proin libero nunc consequat interdum varius. Eget est lorem ipsum dolor sit. Scelerisque eu ultrices vitae auctor eu augue ut lectus arcu. Bibendum neque egestas congue quisque egestas diam. Amet est placerat in egestas erat imperdiet sed euismod. Est placerat in egestas erat imperdiet sed euismod. Blandit cursus risus at ultrices mi tempus imperdiet. Interdum consectetur libero id faucibus nisl. Magna fermentum iaculis eu non diam phasellus vestibulum. Fringilla ut morbi tincidunt augue interdum velit euismod in. Urna nec tincidunt praesent semper feugiat nibh sed. Nunc non blandit massa enim nec dui nunc mattis enim. Pretium viverra suspendisse potenti nullam ac tortor vitae purus. Urna condimentum mattis pellentesque id nibh tortor id aliquet lectus. Velit euismod in pellentesque massa placerat duis ultricies. Mattis enim ut tellus elementum sagittis. Feugiat pretium nibh ipsum consequat nisl. Vulputate sapien nec sagittis aliquam malesuada bibendum. Sit amet mauris commodo quis imperdiet massa. Tristique risus nec feugiat in fermentum posuere. Ut venenatis tellus in metus. Nisl condimentum id venenatis a condimentum vitae sapien pellentesque. Tellus at urna condimentum mattis pellentesque id nibh tortor id. Urna condimentum mattis pellentesque id nibh tortor id. Dictum fusce ut placerat orci nulla. Magna fermentum iaculis eu non diam phasellus vestibulum. Nunc faucibus a pellentesque sit amet. Viverra nibh cras pulvinar mattis nunc. Iaculis nunc sed augue lacus. A erat nam at lectus urna duis convallis convallis. Vitae semper quis lectus nulla at volutpat diam. Lorem sed risus ultricies tristique nulla aliquet enim. Dignissim sodales ut eu sem. Aliquet sagittis id consectetur purus ut faucibus pulvinar elementum integer. Urna duis convallis convallis tellus id interdum. Sit amet aliquam id diam maecenas ultricies. Massa sapien faucibus et molestie ac feugiat sed lectus. Morbi tristique senectus et netus. Rhoncus urna neque viverra justo nec ultrices dui. Eget est lorem ipsum dolor sit amet consectetur adipiscing. Condimentum vitae sapien pellentesque habitant morbi. Varius duis at consectetur lorem donec. Nulla posuere sollicitudin aliquam ultrices sagittis. Odio eu feugiat pretium nibh. Metus dictum at tempor commodo. Nunc sed velit dignissim sodales ut eu sem. Accumsan in nisl nisi scelerisque eu. Adipiscing elit pellentesque habitant morbi tristique senectus et. Nulla facilisi cras fermentum odio eu feugiat pretium. Tellus at urna condimentum mattis. Sagittis nisl rhoncus mattis rhoncus urna neque. Dapibus ultrices in iaculis nunc sed augue lacus. Amet nulla facilisi morbi tempus iaculis urna id volutpat. Diam quis enim lobortis scelerisque fermentum dui. Nulla pharetra diam sit amet nisl. Consectetur adipiscing elit ut aliquam purus sit. Senectus et netus et malesuada fames ac turpis egestas. Semper feugiat nibh sed pulvinar. Id diam vel quam elementum pulvinar etiam non quam lacus. Consectetur adipiscing elit duis tristique sollicitudin. Amet nulla facilisi morbi tempus iaculis urna id. Faucibus interdum posuere lorem ipsum dolor sit. Fusce id velit ut tortor pretium viverra. In arcu cursus euismod quis viverra nibh. Tellus pellentesque eu tincidunt tortor. Ullamcorper malesuada proin libero nunc consequat. Turpis egestas sed tempus urna et pharetra pharetra. Luctus venenatis lectus magna fringilla urna porttitor rhoncus dolor. Ut porttitor leo a diam sollicitudin tempor id eu nisl. Ac tortor dignissim convallis aenean et tortor at risus. Viverra ipsum nunc aliquet bibendum enim facilisis gravida neque convallis. Maecenas accumsan lacus vel facilisis volutpat est velit. Condimentum vitae sapien pellentesque habitant morbi. Semper eget duis at tellus at urna condimentum. Tellus id interdum velit laoreet id. Risus sed vulputate odio ut. Adipiscing enim eu turpis egestas. Duis convallis convallis tellus id interdum velit laoreet id. Quam id leo in vitae turpis massa sed. Eget felis eget nunc lobortis mattis aliquam. Adipiscing enim eu turpis egestas pretium aenean pharetra magna ac. Nisi est sit amet facilisis magna etiam tempor. Platea dictumst vestibulum rhoncus est pellentesque elit. Enim sit amet venenatis urna cursus eget nunc scelerisque viverra. Non tellus orci ac auctor augue mauris augue neque. Egestas integer eget aliquet nibh praesent tristique magna sit amet. In ornare quam viverra orci sagittis eu volutpat odio facilisis. Lacus luctus accumsan tortor posuere ac ut consequat semper viverra. Ac tincidunt vitae semper quis lectus. Diam in arcu cursus euismod. Vel elit scelerisque mauris pellentesque pulvinar pellentesque. Congue quisque egestas diam in arcu cursus euismod quis viverra. Amet venenatis urna cursus eget nunc scelerisque viverra. At volutpat diam ut venenatis tellus in metus vulputate. Mollis nunc sed id semper risus in. Aliquet lectus proin nibh nisl. Quis risus sed vulputate odio ut enim blandit volutpat. Condimentum lacinia quis vel eros. Donec ultrices tincidunt arcu non. Amet consectetur adipiscing elit duis tristique sollicitudin nibh sit. Eu ultrices vitae auctor eu augue ut. Iaculis nunc sed augue lacus viverra. Facilisi morbi tempus iaculis urna id volutpat lacus laoreet non. Leo in vitae turpis massa sed elementum tempus egestas. Elit duis tristique sollicitudin nibh sit. Adipiscing vitae proin sagittis nisl rhoncus mattis rhoncus. Hendrerit dolor magna eget est. Scelerisque fermentum dui faucibus in ornare. Sagittis vitae et leo duis. Sem nulla pharetra diam sit amet nisl suscipit adipiscing bibendum. In massa tempor nec feugiat nisl pretium. Mus mauris vitae ultricies leo integer malesuada nunc. Tortor at auctor urna nunc. Etiam dignissim diam quis enim lobortis scelerisque. Rutrum tellus pellentesque eu tincidunt tortor aliquam. Gravida neque convallis a cras semper auctor neque vitae tempus. Orci nulla pellentesque dignissim enim sit. Magna ac placerat vestibulum lectus mauris ultrices eros. Vitae aliquet nec ullamcorper sit. Senectus et netus et malesuada fames ac turpis egestas sed. Quam adipiscing vitae proin sagittis nisl rhoncus mattis. Blandit cursus risus at ultrices. Consectetur lorem donec massa sapien faucibus et. Suscipit adipiscing bibendum est ultricies integer quis auctor. Ipsum consequat nisl vel pretium lectus quam. Convallis posuere morbi leo urna molestie at elementum. Tristique magna sit amet purus gravida. Amet aliquam id diam maecenas. Sed faucibus turpis in eu mi. Quam lacus suspendisse faucibus interdum posuere lorem. Eget gravida cum sociis natoque penatibus et magnis dis. Ornare aenean euismod elementum nisi. Lacus vel facilisis volutpat est velit egestas dui id. Ullamcorper eget nulla facilisi etiam dignissim diam quis enim lobortis. Turpis cursus in hac habitasse platea dictumst quisque sagittis. Eget velit aliquet sagittis id consectetur purus ut. Mi tempus imperdiet nulla malesuada pellentesque. Pulvinar neque laoreet suspendisse interdum consectetur libero id faucibus. Metus vulputate eu scelerisque felis imperdiet proin. Felis imperdiet proin fermentum leo. Sed vulputate mi sit amet mauris commodo quis imperdiet. Porttitor eget dolor morbi non. Vitae tortor condimentum lacinia quis vel eros. At ultrices mi tempus imperdiet. Tempus iaculis urna id volutpat lacus laoreet. Nibh cras pulvinar mattis nunc sed. Ipsum dolor sit amet consectetur adipiscing elit ut. Pretium viverra suspendisse potenti nullam ac. Urna condimentum mattis pellentesque id. Aliquet eget sit amet tellus. Amet consectetur adipiscing elit pellentesque habitant morbi tristique senectus et. Enim nec dui nunc mattis enim ut tellus elementum. Eget nunc scelerisque viverra mauris in aliquam. Pretium viverra suspendisse potenti nullam ac tortor vitae purus. Blandit libero volutpat sed cras ornare arcu dui vivamus arcu. Pharetra convallis posuere morbi leo. Faucibus a pellentesque sit amet porttitor. Sit amet commodo nulla facilisi. Sed tempus urna et pharetra pharetra massa massa ultricies mi. Ultrices mi tempus imperdiet nulla malesuada pellentesque. Sem nulla pharetra diam sit amet nisl suscipit. Nullam eget felis eget nunc lobortis. Adipiscing elit duis tristique sollicitudin nibh sit amet commodo. Tristique senectus et netus et. Purus viverra accumsan in nisl nisi scelerisque eu ultrices. Aenean pharetra magna ac placerat vestibulum lectus. Interdum varius sit amet mattis. Id aliquet lectus proin nibh nisl. Tellus integer feugiat scelerisque varius morbi enim nunc faucibus a. Duis ultricies lacus sed turpis tincidunt id aliquet risus feugiat. Scelerisque eleifend donec pretium vulputate sapien nec sagittis aliquam. Augue mauris augue neque gravida in fermentum et. Amet tellus cras adipiscing enim. Egestas sed sed risus pretium quam vulputate dignissim suspendisse. Ut ornare lectus sit amet est placerat in. Ipsum consequat nisl vel pretium lectus quam. Sapien eget mi proin sed. Dapibus ultrices in iaculis nunc sed augue lacus viverra vitae. Volutpat sed cras ornare arcu dui vivamus. Turpis cursus in hac habitasse. Placerat vestibulum lectus mauris ultrices eros in cursus turpis massa. Quisque egestas diam in arcu cursus euismod quis. Volutpat est velit egestas dui. Nunc pulvinar sapien et ligula ullamcorper. Amet venenatis urna cursus eget. Sit amet nisl purus in mollis nunc sed id. Congue eu consequat ac felis donec et odio pellentesque. Molestie nunc non blandit massa enim nec dui nunc. In fermentum et sollicitudin ac orci phasellus egestas. Metus vulputate eu scelerisque felis. Felis imperdiet proin fermentum leo vel. Cursus risus at ultrices mi tempus imperdiet nulla malesuada pellentesque. Duis tristique sollicitudin nibh sit amet commodo nulla facilisi nullam. Duis ut diam quam nulla porttitor. Egestas integer eget aliquet nibh praesent tristique magna. Nec feugiat in fermentum posuere urna nec tincidunt praesent. Quis blandit turpis cursus in hac habitasse. Adipiscing commodo elit at imperdiet dui accumsan sit. Leo a diam sollicitudin tempor id eu."
    raise Exception(err_msg)
    sync.sync_stream(config, catalog, state, collect_sync_stats)

    if collect_sync_stats:
        headers = [['table_name',
                    'file path',
                    'row count',
                    'last_modified']]

        rows = []

        for table_name, table_data in FILE_SYNC_STATS.items():
            for filepath, file_data in table_data['files'].items():
                rows.append([table_name,
                             filepath,
                             file_data['row_count'],
                             file_data['last_modified']])

        data = headers + rows
        table = AsciiTable(data, title='Extraction Summary')
        LOGGER.info("\n\n%s", table.table)
        LOGGER.info('Done syncing.')


@singer.utils.handle_top_exception(LOGGER)
def main():
    try:
        # used for storing error info to write if error occurs
        error_info = None
        args = utils.parse_args(REQUIRED_CONFIG_KEYS)
        # validate tables config
        for table in args.config.get('tables'):
            utils.check_config(table, REQUIRED_COMMON_TABLE_SPEC_CONFIG_KEYS)
            file_type = table.get("file_type")
            if file_type in ["csv", "text", "fwf"]:
                utils.check_config(table, REQUIRED_CSV_TABLE_SPEC_CONFIG_KEYS)

        decrypt_configs = args.config.get('decryption_configs')
        if decrypt_configs:
            # validate decryption configs
            utils.check_config(decrypt_configs, REQUIRED_DECRYPT_CONFIG_KEYS)

        if args.discover:
            do_discover(args.config)
        elif args.catalog or args.properties:
            do_sync(args.config, args.catalog, args.state)
    except SymonException as e:
        error_info = {
            'message': str(e),
            'code': e.code,
            'traceback': traceback.format_exc()
        }

        if e.details is not None:
            error_info['details'] = e.details
        raise
    except BaseException as e:
        error_info = {
            'message': str(e),
            'traceback': traceback.format_exc()
        }
        raise
    finally:
        if error_info is not None:
            error_file_path = args.config.get('error_file_path', None)
            if error_file_path is not None:
                try:
                    with open(error_file_path, 'w', encoding='utf-8') as fp:
                        json.dump(error_info, fp)
                except:
                    pass
            # log error info as well in case file is corrupted
            error_info_json = json.dumps(error_info)
            error_start_marker = args.config.get(
                'error_start_marker', '[tap_error_start]')
            error_end_marker = args.config.get(
                'error_end_marker', '[tap_error_end]')
            LOGGER.info(
                f'{error_start_marker}{error_info_json}{error_end_marker}')


if __name__ == "__main__":
    main()
